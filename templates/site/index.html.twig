{% extends 'base.html.twig' %}

{% block body %}
    {% for product in favoritedProducts %}
        {% set discount = productDiscounts[product.productId] %}
        {% set productDiscountDates = discountDates[product.productId] %}
        <div class="favorited-product mt-5">
            <div class="row">
                <div class="col-lg-3">
                    <div class="product-item">
                        <div class="row">
                            <div class="col">
                                <img src="{{ product.imgLink }}" class="img-fluid" alt="{{ product.name }}">
                            </div>
                            <div class="col">
                                <div class="mt-1 text-center">
                                    <div class="fs-2 text-success price-discount">
                                        {{ discount.priceDiscount }}
                                    </div>
                                    <div class="fs-4 price-normal">
                                        {{ discount.priceNormal }}
                                    </div>
                                    <div class="mt-2 date-range">
                                        <span class="date-begin">{{ discount.dateBegin|date('d.m.Y') }}</span>
                                        - <span class="date-end">{{ discount.dateEnd|date('d.m.Y') }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <small>{{ product.name }}</small>
                            </div>
                        </div>
                        <a href="{{ path('remove_from_favorites', {'productId': product.productId}) }}"
                           class="remove-from-favorites text-danger"
                           title="Удалить из избранного"
                           data-id="{{ product.productId }}"
                        >
                            <i class="fa fa-close"></i>
                        </a>
                    </div>
                </div>
                <div class="col-lg-9">
                    <div class="history-months">
                        <div class="row">
                            <div class="col text-center">Январь</div>
                            <div class="col text-center">Февраль</div>
                            <div class="col text-center">Март</div>
                            <div class="col text-center">Апрель</div>
                            <div class="col text-center">Май</div>
                            <div class="col text-center">Июнь</div>
                            <div class="col text-center">Июль</div>
                            <div class="col text-center">Август</div>
                            <div class="col text-center">Сентябрь</div>
                            <div class="col text-center">Октябрь</div>
                            <div class="col text-center">Ноябрь</div>
                            <div class="col text-center">Декабрь</div>
                        </div>
                    </div>

                    <div class="discount-history">
                        <div class="row">
                            <div class="col">
                                <table class="table table-bordered">
                                    {% for weekDay in 1..7 %}
                                        <tr>
                                            {% for date in currentYearDates %}
                                                {% if date|date('N') == weekDay %}
                                                    <td class="{{ date in productDiscountDates ? 'discount-cell bg-success' : 'empty-cell' }}"
                                                        title="{{ date|date('d.m.Y') }}"
                                                        data-product_id="{{ product.productId }}"
                                                        data-discount_date="{{ date|date('d.m.Y') }}"
                                                    >

                                                    </td>
                                                {% endif %}
                                            {% endfor %}
                                        </tr>
                                    {% endfor %}
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}
{% endblock %}